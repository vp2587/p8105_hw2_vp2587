---
title: "P8105 HW2"
author: "Veerapetch Petchger"
date: "2025-10-01"
output: html_document
---

## Problem 1
#### This problem uses the FiveThirtyEight data; these data were gathered to create the interactive graphic on this page. In particular, we’ll use the data in pols-month.csv, unemployment.csv, and snp.csv. Our goal is to merge these into a single data frame using year and month as keys across datasets.

#### First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.
```{r setup, include = FALSE}
library(tidyverse)
library(lubridate)
```

```{r pols-month}
pols_month_df = 
  read.csv("fivethirtyeight_datasets/pols-month.csv", na = c("NA",".","")) %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(month = factor(month.name[month], levels = month.name, ordered = TRUE),
         president = if_else(prez_gop == 1, "gop", "dem")) %>%
select(-day, -prez_dem, -prez_gop)
```

#### Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.
```{r snp}
snp_df = 
  read.csv("fivethirtyeight_datasets/snp.csv", na = c("NA",".","")) %>% 
  janitor::clean_names() %>% 
  mutate(
    date = mdy(date),
    year = year(date),
    month = factor(month.name[month(date)], levels = month.name, ordered = TRUE)
  ) %>% 
  arrange(year, month) %>% 
  select(year, month, close)
```


#### Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.
```{r unemployment}
unemployment_df = 
  read.csv("fivethirtyeight_datasets/unemployment.csv", na = c("NA",".","")) %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    col = jan:dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) %>% 
  mutate(
    month_num = match(str_to_title(month), month.abb),
    month = factor(month.name[month_num], levels = month.name, ordered = TRUE)
  ) %>% 
  select(year, month, unemployment_rate) %>% 
  arrange(year, month)
```


#### Join the datasets by merging snp into pols, and merging unemployment into the result.

#### Write a short paragraph about these datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).

#### Note: we could have used a date variable as a key instead of creating year and month keys; doing so would help with some kinds of plotting, and be a more accurate representation of the data. Date formats are tricky, though. For more information check out the lubridate package in the tidyverse.

